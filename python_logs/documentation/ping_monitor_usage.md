# 网站连接监控脚本使用说明

## 脚本功能
持续监控 `https://production-kul.unitedcaps.com/` 网站的连接状态，当响应时间超过1分钟时，自动将超时信息记录到 `timeout.txt` 文件中。

## 脚本文件说明

### 1. simple_ping_monitor.py (推荐使用)
**生产环境版本** - 功能完整，适合长期运行
- ✅ 持续ping指定网站
- ✅ 60秒超时阈值
- ✅ 自动记录超时到timeout.txt
- ✅ 实时统计信息
- ✅ 优雅的停止和报告

### 2. continuous_ping_monitor.py
**详细版本** - 包含更多监控功能
- ✅ 完整的连接测试
- ✅ SSL证书检查
- ✅ DNS解析测试
- ✅ 详细的错误处理

### 3. test_ping_monitor.py
**测试版本** - 用于快速验证功能
- ✅ 2秒超时阈值（快速测试）
- ✅ 验证文件写入功能

## 使用方法

### 启动监控
```bash
python simple_ping_monitor.py
```

### 停止监控
按 `Ctrl+C` 停止脚本

### 查看超时记录
超时信息会自动保存到 `timeout.txt` 文件中，格式如下：
```
[2025-07-29 09:30:15] 第5次检查 - 连接超时 - 响应时间: 60.02秒 - 超过1分钟阈值
[2025-07-29 09:35:20] 第8次检查 - 连接超时 - 响应时间: 60.15秒 - 超过1分钟阈值
```

## 运行示例

```
🚀 开始持续ping监控
🎯 目标网站: https://production-kul.unitedcaps.com/
⏰ 超时阈值: 60秒 (1分钟)
📝 超时日志: timeout.txt
🛑 按 Ctrl+C 停止监控
============================================================

[1] 2025-07-29 09:30:10 - 正在ping...
✅ 成功 - 0.85秒 - 状态码: 200
📊 统计: 总计1次, 成功1次, 超时0次, 成功率100.0%
⏳ 等待5秒后继续...

[2] 2025-07-29 09:30:16 - 正在ping...
✅ 成功 - 0.92秒 - 状态码: 200
📊 统计: 总计2次, 成功2次, 超时0次, 成功率100.0%
⏳ 等待5秒后继续...
```

## 配置说明

### 修改监控间隔
在脚本中找到这行代码：
```python
time.sleep(5)  # 等待5秒
```
修改数字可以改变检查间隔（单位：秒）

### 修改超时阈值
在脚本中找到这行代码：
```python
response = requests.get(website, timeout=60)  # 60秒超时
```
修改60为其他数值可以改变超时阈值（单位：秒）

### 修改目标网站
在脚本中找到这行代码：
```python
website = "https://production-kul.unitedcaps.com/"
```
修改URL为其他网站地址

## 注意事项

1. **网络要求**: 确保运行脚本的机器能够访问目标网站
2. **权限要求**: 确保脚本有权限在当前目录创建和写入timeout.txt文件
3. **长期运行**: 脚本设计为长期运行，可以在服务器上作为监控工具使用
4. **资源消耗**: 每5秒检查一次，资源消耗很低
5. **日志管理**: timeout.txt文件会持续追加，建议定期清理或轮转

## 故障排除

### 常见错误
- **ModuleNotFoundError**: 需要安装requests库 `pip install requests`
- **Permission denied**: 检查文件写入权限
- **Connection refused**: 检查网络连接和目标网站状态

### 依赖安装
```bash
pip install requests
```

## 输出文件说明

### timeout.txt格式
每行包含以下信息：
- 时间戳：[YYYY-MM-DD HH:MM:SS]
- 检查次数：第X次检查
- 事件类型：连接超时
- 响应时间：实际响应时间
- 阈值说明：超过1分钟阈值